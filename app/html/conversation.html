<div id="message" class="page-wrapper cs-pm-page-wrapper" style="display: block">

  <div class="messages-header cs-pm__header clearfix" ng-cloak>
    <h2 class="pull-left cs-pm-left"><a ng-click="goToInbox()" class="messages-trigger"><span class="icomoon icomoon-back cs-pm-icon--back"></span>{{ heading__messages }}</a></h2>
    <div class="pull-right cs-pm-right"><a ui-sref="message" class="btn btn-default cs-pm__new-message"><span class="icomoon icomoon-speech-bubble cs-pm-icon--new-message"></span> {{ button__new_conversation }}</a></div>
  </div>

  <div class="alert alert-warning" ng-show="currentUser.preferences.read_only_mode"
       ng-bind-html="text_read_only | htmlsafe"></div>

  <div class="messages-header cs-pm__header conversation-header clearfix">
    <h2 class="pull-left cs-pm-left" ng-cloak>{{ conversationHeading }}</h2>

    <div class="conversation-actions">
      <a href="" ui-sref="conversation.delete" class="btn btn-link btn-small delete-conversation"
         ng-bind="link__delete"></a>
      <a href="" ui-sref="conversation.report" class="btn btn-link btn-small report-conversation"
         ng-show="!currentUser.permissions.conversations.report"
         ng-bind-html="link__report | htmlsafe"></a>
      <a ng-hide="isContactBlocked" href="" ui-sref="conversation.block" class="btn btn-link btn-small"
         ng-bind="link__block"></a>
      <a ng-show="isContactBlocked" href="#" class="btn btn-link btn-small" ng-bind="link__unblock"></a>
    </div>
  </div>


  <!--<ul class="media-list">-->
    <!--<li ng-repeat="message in messages">-->
      <!--<span>{{message.id}}</span>  <span>{{message.text}}</span>-->
    <!--</li>-->
  <!--</ul>-->

  <div id="conversation-wrapper" class="conversation-wrapper" style="max-height: 600px; overflow: auto"
       scroll-glue="!!glued" ui-scroll-viewport    >

    <div class="delete-message-msg collapse">
      <div class="alert alert-info" role="alert" ng-cloak>{{ text__select_messages_to_delete }}</div>
    </div>

    <div class="clearfix text-center">
      <a class="btn btn-primary btn-load-more" id="load-more" ng-cloak ng-click="loadMore()" ng-show="moreMessages">{{
        button__load_older_messages }}</a>
    </div>




    <ul class="media-list">
      <!--<li ui-scroll="message in messagesDatasource" buffer-size="10" padding="0.3">-->
        <!--<span>{{message.id}}</span>  <span>{{message.text}}</span>-->
      <!--</li>-->
      <!--<li ng-repeat="message in messages | orderBy:'id'"-->
      <li ui-scroll="message in messagesDatasource" buffer-size="10" padding="0.3" adapter="scrollAdapter"
          ng-class="{'message-own': message.sender.id === $parent.currentUser.user.id}"
          class="media">
        <div ng-hide="'Hiding this until we implement message deletion'"
             class="media-left checkbox-wrap">
          <div class="checkbox"><label><input type="checkbox" value="message.id"
                                              aria-label="Delete this message"></label></div>
        </div>
        <div ng-if="message.sender.id !== $parent.currentUser.user.id" class="media-left cs-pm__avatar">
          <img class="media-object" ng-src="{{ message.sender.avatars['100-100'] }}" alt="" style="width:50px;height:50px;">
        </div>
        <div class="cs-pm-body media-body">
          <div class="cs-pm-message-meta message-meta small"><a
            ng-hide="message.sender.id === $parent.currentUser.user.id" ng-href="message.sender.profile"
            ng-bind="message.sender.name"></a> <abbr class="timeago"
                                                            ng-attr-title="{{message.sent | formatDate}}"
                                                            ng-bind="message.sent | dateFromNow"></abbr><strong>---{{message.id}}***{{message.index}}</strong> </div>
          <div class="cs-pm-message message arrow_box"><p ng-bind-html="message.text | htmlsafe"></p></div>
        </div>
      </li>
    </ul>

  </div>

  <div class="cs-pm-reply-wrapper reply-wrapper">
    <form>

      <div class="form-group">
        <textarea id="reply-text" class="form-control" rows="3" placeholder="Reply..."
                  ng-change="unglue()"
                  ng-disabled="currentUser.preferences.read_only_mode || !isContactAvailable"
                  ng-model="reply.text"></textarea>
      </div>

      <div class="clearfix">
        <button id="reply-submit" ng-click="submitReply()" type="submit"
                class="btn btn-default pull-right cs-pm-right message-trigger"
                ng-disabled="currentUser.preferences.read_only_mode || !isContactAvailable"
                ng-bind-html="form__new_conversation__submit | htmlsafe"></button>
      </div>

    </form>
  </div>

</div>
